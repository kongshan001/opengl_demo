# OpenGL Demo 架构文档

## 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        Application Layer                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Application                            │   │
│  │  - 窗口管理 (GLFW)                                        │   │
│  │  - OpenGL 初始化 (GLAD)                                   │   │
│  │  - 主循环                                                  │   │
│  │  - 输入处理                                                │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Scene Layer                              │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐           │
│  │ Camera  │  │  CMesh  │  │CMaterial│  │ CShader │           │
│  │         │  │         │  │         │  │         │           │
│  │ - View  │  │ - VAO   │  │ - Color │  │ - VS/FS │           │
│  │ - Proj  │  │ - VBO   │  │ - Props │  │ - Uniform│          │
│  │ - Input │  │ - EBO   │  │ - Tex   │  │ - Cache │           │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Resource Layer                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  CTexture   │  │ ModelLoader │  │  MeshUtils  │             │
│  │             │  │             │  │             │             │
│  │ - stb_image │  │ - OBJ Parse │  │ - Cube      │             │
│  │ - GL Texture│  │ - Material  │  │ - Sphere    │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      OpenGL / GLFW Layer                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              OpenGL 3.3 Core Profile                      │   │
│  │              GLFW Window Management                       │   │
│  │              GLAD Loader                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## 模块职责

### 1. Application Layer
负责应用程序的生命周期管理。

| 组件 | 职责 |
|------|------|
| Application | 主程序入口、窗口管理、渲染循环 |
| Camera | 3D 相机、视角控制 |

### 2. Scene Layer
负责场景渲染。

| 组件 | 职责 |
|------|------|
| CShader | 着色器编译、链接、uniform 管理 |
| CMesh | 顶点数据、VAO/VBO 管理、绘制 |
| CMaterial | 材质属性、纹理绑定 |

### 3. Resource Layer
负责资源加载。

| 组件 | 职责 |
|------|------|
| CTexture | 纹理加载、GL 纹理管理 |
| ModelLoader | 模型文件解析 |
| MeshUtils | 几何体生成 |

## 数据流

```
用户输入
    │
    ▼
┌─────────┐
│ Camera  │ ──────► View Matrix
└─────────┘         Projection Matrix
    │
    ▼
┌─────────────┐
│ Application │ ──────► Set Uniforms
└─────────────┘
    │
    ▼
┌─────────┐     ┌──────────┐     ┌──────────┐
│ CShader │ ◄── │ CMaterial│ ◄── │ CTexture │
└─────────┘     └──────────┘     └──────────┘
    │
    ▼
┌─────────┐
│  CMesh  │ ──────► glDrawElements
└─────────┘
    │
    ▼
  屏幕
```

## 渲染管线

```
1. 初始化阶段
   ├── GLFW 窗口创建
   ├── GLAD OpenGL 加载
   ├── 编译着色器
   ├── 加载纹理
   └── 创建网格 VAO

2. 渲染循环
   ├── 处理输入 (Input)
   ├── 更新相机 (Camera)
   ├── 清除缓冲 (glClear)
   ├── 设置 Uniform
   │   ├── view
   │   ├── projection
   │   ├── model
   │   └── material.*
   ├── 绘制网格 (glDrawElements)
   └── 交换缓冲 (glfwSwapBuffers)

3. 清理阶段
   └── GL 资源释放 (RAII)
```

## 依赖关系

```
Application
    ├── GLFW (窗口)
    ├── GLAD (OpenGL 加载)
    ├── GLM (数学库)
    ├── stb_image (图片加载)
    └── Google Test (测试)
```

## 文件结构

```
opengl_demo/
├── include/              # 头文件
│   ├── core/            # 核心模块
│   │   ├── Application.h
│   │   └── Camera.h
│   ├── shader/          # 着色器模块
│   │   └── Shader.h
│   └── mesh/            # 网格模块
│       ├── Mesh.h
│       ├── Material.h
│       ├── Texture.h
│       ├── Vertex.h
│       └── ModelLoader.h
├── src/                  # 源文件
│   ├── main.cpp
│   ├── core/
│   ├── shader/
│   └── mesh/
├── tests/                # 测试文件
├── resources/            # 资源文件
│   ├── shaders/         # GLSL 着色器
│   ├── textures/        # 纹理图片
│   └── models/          # 模型文件
├── doc/                  # 文档
└── cmake/                # CMake 模块
```

---

*最后更新: 2026-02-21*
